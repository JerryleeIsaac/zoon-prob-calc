<html>
	<head>
		<title>Zoon Probability Calculator</title>
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
		<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
	</head>

	<body>
		<div class="container-fluid mt-5">

			<h1>Zoon Outcome Probability Calculator</h1>

			<!--Probability Form-->
			<form id="probabilityForm">

				<div class="form-row">
					<!--Total Games-->
					<div class="col-sm-12 col-md-6">
						<label for="fightCount">Number of Fights</label>
						<input type="number" class="form-control" id="fightCount"  value=0>
					</div>


					<!--Win Rate-->
					<div class="col-sm-12 col-md-6">
						<label for="winRate">Win Rate</label>
						<div class="input-group">
							<select class="form-control" id="winRate">
								<option value=0.8>80</option>
								<option value=0.7>70</option>
								<option value=0.6>60</option>
								<option value=0.2>20</option>
							</select>
							<div class="input-group-append">
								<span class="input-group-text">%</span>
							</div>
						</div>
					</div>

					<!--Outcome Type-->
					<div class="col-sm-12">
						<label for="outcomeType">Outcome Type</label>
						<select class="form-control" id="outcomeType">
							<option>Minimum number of wins</option>
							<option>Number of wins</option>
						</select>
					</div>

					<!--Minimum Reward-->
					<div class="col-sm-12 col-md-6">
						<label for="minReward">Minimum reward</label>
						<input type="number" class="form-control" id="minReward"  value=100>
					</div>

					<!--Maximum Reward-->
					<div class="col-sm-12 col-md-6">
						<label for="maxReward">Maximum reward</label>
						<input type="number" class="form-control" id="maxReward"  value=200>
					</div>

				</div>

				<div class="form-group mt-2">
					<button class="btn btn-info" type="submit">Compute Outcomes</button>
				</div>
			</form>

			<div id="outcomes"></div>

		</div>


		<script>
			function productRange(a,b) {
				var prd = a,i = a;

				while (i++< b) {
					prd*=i;
				}
				return prd;
			}


			function combinations(n, r) {
				if (n==r || r==0) {
					return 1;
				} else {
					r=(r < n-r) ? n-r : r;
					return productRange(r+1, n)/productRange(1,n-r);
				}
			}

			function decimalTruncate(num) {
				return Math.round(100 * num) / 100;
			}

		</script>

	<script>



		let form = document.getElementById("probabilityForm");
		form.onsubmit = (event) => {
			event.preventDefault();

			let outcomesDiv = document.getElementById("outcomes");
			outcomesDiv.innerHTML = "";

			let winRate = parseFloat(document.getElementById("winRate").value);
			let fightCount = parseInt(document.getElementById("fightCount").value);
			let outcomeType = document.getElementById("outcomeType").value.toString();
			let minReward = parseInt(document.getElementById("minReward").value);
			let maxReward = parseInt(document.getElementById("maxReward").value);


			// Calculate probabilities
			let outcomes = [];
			let winCount = 0;
			for (winCount = 0; winCount <= fightCount; winCount++) {
				let combination = combinations(fightCount, winCount);
				let p = winRate;
				let q = 1 - winRate;
				let n = fightCount;
				let k = winCount;

				let probability = 100 * combination * (p ** k) * (q ** (n-k));

				outcomes.push({
					winCount: winCount,
					probability: probability,
					minProbability: probability,
					minTotalRewards: winCount * minReward,
					maxTotalRewards: winCount * maxReward,
				});
			}

			// Calculate cumulative probabilities
			let cumProbability = outcomes[0].probability;
			for (winCount = 1; winCount <= fightCount; winCount++) {
				outcomes[winCount].minProbability = 100 - cumProbability;
				cumProbability += outcomes[winCount].probability;
			}

			let outcomeTable = document.createElement("table");
			outcomeTable.classList.add("table");
			outcomeTable.innerHTML = `
					<thead>
						<tr>
							<th scope="col">`+ outcomeType + `</th>
							<th scope="col">Outcome Probability</th>
							<th scope="col">Minimum Total Rewards</th>
							<th scope="col">Maximum Total Rewards</th>
						</tr>
					</thead>
			`

			let outcomeTableBody = document.createElement("tbody");
			outcomes.forEach(outcome => {
				outcomeTableBody.innerHTML += `
				<tr>
					<td scope="row" class="text-right">` + outcome.winCount.toString() + `</td>
					<td class="text-right">` + (outcomeType == "Minimum number of wins" ? decimalTruncate(outcome.minProbability).toString() : decimalTruncate(outcome.probability).toString()) + `%</td>
					<td class="text-right">` + decimalTruncate(outcome.minTotalRewards).toString() + `</td>
					<td class="text-right">` + decimalTruncate(outcome.maxTotalRewards).toString() + `</td>
				</tr>
				`;
			});
			outcomeTable.appendChild(outcomeTableBody);
			outcomesDiv.appendChild(outcomeTable);

		};
	</script>
	</body>
</html>
